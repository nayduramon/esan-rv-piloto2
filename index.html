<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>ESAN 360 - Trayectoria histórica</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body>
  <a-scene>

    <a-assets>
      <img id="esan360" src="gth.jpeg">
      <video id="videoUni" src="video2.mp4" loop="false" crossorigin="anonymous" playsinline webkit-playsinline></video>
      <img id="galaxy1" src="https://cdn.glitch.global/c33f23a4-927b-40b4-b043-4e48b3c4377a/galaxy1.webp?v=1706404988000">
      <img id="galaxy2" src="https://cdn.glitch.global/c33f23a4-927b-40b4-b043-4e48b3c4377a/galaxy2.webp?v=1706404988000">
      <img id="galaxy3" src="https://cdn.glitch.global/c33f23a4-927b-40b4-b043-4e48b3c4377a/galaxy3.webp?v=1706404988000">
    </a-assets>

    <a-sky src="#esan360" rotation="0 -90 0"></a-sky>

    <a-sphere
      id="telonNegro"
      radius="60"
      material="color: #000; side: back; transparent: true; opacity: 0; shader: flat"
      animation__oscurecer="property: material.opacity; to: 1; dur: 3000; startEvents: cineStart; easing: easeInOutQuad"
      animation__aclarar="property: material.opacity; to: 0; dur: 3000; startEvents: cineEnd; easing: easeInOutQuad">
    </a-sphere>

    <a-entity id="estrellas" visible="false"></a-entity>
    <a-entity id="galaxiasLejanas" visible="false"></a-entity> 

    <a-video
      id="pantallaVideo"
      src="#videoUni"
      width="5"
      height="3"
      position="0 1.6 -30"
      visible="false"
      animation__entrar="property: position; to: 0 1.6 -4; dur: 8000; easing: easeOutCubic; startEvents: videoEntra"
      animation__salir="property: position; to: 0 1.6 -30; dur: 4000; easing: easeInQuad; startEvents: videoSale">
    </a-video>

    <a-entity
      id="contenedorBoton"
      position="0 1.6 -15"
      visible="true"
      animation="property: position; to: 0 1.6 -2.5; dur: 8000; easing: easeOutCubic; delay: 500">

      <a-circle id="btnAccion" class="clickable" color="#000000" opacity="0.6" radius="0.65">
        <a-text id="textoBoton" value="CONOCE NUESTRA\nHISTORIA" align="center" color="#FFFFFF" width="1" wrap-count="20"></a-text>
      </a-circle>
    </a-entity>

    <a-entity camera look-controls position="0 1.6 0">
      <a-cursor color="#FFD700" radius="0.015" scale="0.3 0.3 0.3" raycaster="objects: .clickable"></a-cursor>
    </a-entity>

  </a-scene>

  <script>
    const video = document.querySelector('#videoUni');
    const pantalla = document.querySelector('#pantallaVideo');
    const contenedorBtn = document.querySelector('#contenedorBoton');
    const btnAccion = document.querySelector('#btnAccion');
    const telonNegro = document.querySelector('#telonNegro');
    const estrellasContainer = document.querySelector('#estrellas');
    const galaxiasContainer = document.querySelector('#galaxiasLejanas'); // Nuevo contenedor para galaxias

    // --- FUNCIÓN PARA GENERAR ESTRELLAS ALEATORIAS ---
    function generarEstrellas(cantidad) {
      for (let i = 0; i < cantidad; i++) {
        let estrella = document.createElement('a-sphere');
        
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos((Math.random() * 2) - 1);
        let dist = 50; 

        let x = dist * Math.sin(phi) * Math.cos(theta);
        let y = dist * Math.sin(phi) * Math.sin(theta);
        let z = dist * Math.cos(phi);

        estrella.setAttribute('position', `${x} ${y} ${z}`);
        estrella.setAttribute('radius', Math.random() * 0.15); 
        estrella.setAttribute('material', 'color: #FFF; shader: flat');
        
        estrella.setAttribute('animation', {
          property: 'material.opacity',
          from: Math.random(),
          to: 1,
          dur: Math.random() * 2000 + 1000,
          dir: 'alternate',
          loop: true
        });

        estrellasContainer.appendChild(estrella);
      }
    }

    // --- FUNCIÓN PARA GENERAR GALAXIAS LEJANAS ---
    function generarGalaxias(cantidad) {
      const galaxyImages = ['#galaxy1', '#galaxy2', '#galaxy3']; // IDs de las imágenes de galaxias

      for (let i = 0; i < cantidad; i++) {
        let galaxia = document.createElement('a-sphere');
        
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos((Math.random() * 2) - 1);
        let dist = 58; // Un poco más cerca del telón, pero detrás de las estrellas

        let x = dist * Math.sin(phi) * Math.cos(theta);
        let y = dist * Math.sin(phi) * Math.sin(theta);
        let z = dist * Math.cos(phi);

        galaxia.setAttribute('position', `${x} ${y} ${z}`);
        galaxia.setAttribute('radius', Math.random() * 8 + 5); // Tamaños de galaxias variados, más grandes que estrellas
        galaxia.setAttribute('material', `src: ${galaxyImages[Math.floor(Math.random() * galaxyImages.length)]}; side: front; transparent: true; opacity: ${Math.random() * 0.6 + 0.2}; shader: flat`); // Opacidad variable
        
        // Animación de brillo (simulando que unas brillan más que otras)
        galaxia.setAttribute('animation', {
            property: 'material.opacity',
            from: Math.random() * 0.4 + 0.3, // Opacidad inicial más baja
            to: Math.random() * 0.8 + 0.5,   // Opacidad máxima más alta
            dur: Math.random() * 4000 + 2000, // Duración más larga para un brillo sutil
            dir: 'alternate',
            loop: true
        });

        galaxiasContainer.appendChild(galaxia);
      }
    }

    // Generamos 200 estrellas y 10 galaxias al cargar
    generarEstrellas(200);
    generarGalaxias(10); // Puedes ajustar la cantidad de galaxias

    // --- LÓGICA DE EVENTOS ---
    btnAccion.addEventListener('click', function() {
      contenedorBtn.setAttribute('visible', 'false');
      telonNegro.emit('cineStart');
      
      setTimeout(() => {
        estrellasContainer.setAttribute('visible', 'true');
        galaxiasContainer.setAttribute('visible', 'true'); // Mostrar galaxias también
      }, 500);

      video.currentTime = 0;
      pantalla.setAttribute('visible', 'true');
      pantalla.emit('videoEntra');

      setTimeout(() => { video.play(); }, 1000);
    });

    video.addEventListener('ended', function() {
      telonNegro.emit('cineEnd');
      estrellasContainer.setAttribute('visible', 'false');
      galaxiasContainer.setAttribute('visible', 'false'); // Ocultar galaxias
      pantalla.emit('videoSale');

      setTimeout(() => {
        pantalla.setAttribute('visible', 'false');
        contenedorBtn.setAttribute('visible', 'true');
      }, 4000);
    });
  </script>
</body>
</html>







