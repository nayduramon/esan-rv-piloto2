<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>ESAN 360 - Galaxia Inmersiva</title>
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
</head>

<body>
  <a-scene>
    <a-assets>
      <img id="esan360" src="gth.jpeg">
      <video id="videoUni" src="video2.mp4" loop="false" crossorigin="anonymous" playsinline webkit-playsinline></video>
    </a-assets>

    <a-sky src="#esan360" rotation="0 -90 0"></a-sky>

    <a-sphere
      id="telonNegro"
      radius="60"
      material="color: #000; side: back; transparent: true; opacity: 0; shader: flat"
      animation__oscurecer="property: material.opacity; to: 1; dur: 2500; startEvents: cineStart"
      animation__aclarar="property: material.opacity; to: 0; dur: 2500; startEvents: cineEnd">
    </a-sphere>

    <a-entity id="estrellas" visible="false"></a-entity>
    <a-entity id="galaxiasLejanas" visible="false"></a-entity> 

    <a-video
      id="pantallaVideo"
      src="#videoUni"
      width="5"
      height="3"
      position="0 1.6 -30"
      visible="false"
      animation__entrar="property: position; to: 0 1.6 -4; dur: 8000; easing: easeOutCubic; startEvents: videoEntra"
      animation__salir="property: position; to: 0 1.6 -30; dur: 4000; easing: easeInQuad; startEvents: videoSale">
    </a-video>

    <a-entity id="contenedorBoton" position="0 1.6 -2.5">
      <a-circle id="btnAccion" class="clickable" color="#000" opacity="0.8" radius="0.6">
        <a-text id="textoBoton" value="CONOCE NUESTRA\nHISTORIA" align="center" color="#FFF" width="1.5"></a-text>
      </a-circle>
    </a-entity>

    <a-entity camera look-controls position="0 1.6 0">
      <a-cursor color="#FFD700" raycaster="objects: .clickable"></a-cursor>
    </a-entity>
  </a-scene>

  <script>
    const estrellasContainer = document.querySelector('#estrellas');
    const galaxiasContainer = document.querySelector('#galaxiasLejanas');
    const telonNegro = document.querySelector('#telonNegro');
    const video = document.querySelector('#videoUni');
    const pantalla = document.querySelector('#pantallaVideo');
    const btnAccion = document.querySelector('#btnAccion');
    const contenedorBtn = document.querySelector('#contenedorBoton');

    // 1. GENERAR ESTRELLAS CON BRILLOS DIFERENTES
    function crearEstrellas(n) {
      for (let i = 0; i < n; i++) {
        let estrella = document.createElement('a-sphere');
        let d = 50;
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos((Math.random() * 2) - 1);

        estrella.setAttribute('position', {
          x: d * Math.sin(phi) * Math.cos(theta),
          y: d * Math.sin(phi) * Math.sin(theta),
          z: d * Math.cos(phi)
        });

        // Unas más grandes y brillantes que otras
        let size = Math.random() * 0.12 + 0.02; 
        let brightness = Math.random() * 0.8 + 0.2; // Rango de 0.2 a 1.0

        estrella.setAttribute('radius', size);
        estrella.setAttribute('material', `color: #FFF; shader: flat; opacity: ${brightness}; transparent: true`);
        
        // Animación de parpadeo desigual
        estrella.setAttribute('animation', {
          property: 'material.opacity',
          from: brightness * 0.5,
          to: brightness,
          dur: Math.random() * 5000 + 2000,
          dir: 'alternate',
          loop: true
        });
        estrellasContainer.appendChild(estrella);
      }
    }

    // 2. GENERAR GALAXIAS USANDO DISCOS DE COLOR (Sin imágenes externas)
    function crearGalaxias(n) {
      const colores = ['#4b0082', '#0000ff', '#ff00ff', '#1e90ff']; // Indigo, Blue, Magenta, Blue
      for (let i = 0; i < n; i++) {
        let g = document.createElement('a-ring'); // Usamos a-ring para efecto de disco
        let d = 55;
        let theta = Math.random() * Math.PI * 2;
        let phi = Math.acos((Math.random() * 2) - 1);

        g.setAttribute('position', {
          x: d * Math.sin(phi) * Math.cos(theta),
          y: d * Math.sin(phi) * Math.sin(theta),
          z: d * Math.cos(phi)
        });

        // Orientar hacia el centro (la cámara)
        g.setAttribute('look-at', '[camera]'); 
        
        let color = colores[Math.floor(Math.random() * colores.length)];
        g.setAttribute('radius-inner', '0.1');
        g.setAttribute('radius-outer', Math.random() * 6 + 2);
        g.setAttribute('material', `color: ${color}; shader: flat; transparent: true; opacity: 0.4; side: double`);
        
        // Brillo de galaxia
        g.setAttribute('animation', {
          property: 'material.opacity',
          from: 0.1,
          to: 0.5,
          dur: Math.random() * 5000 + 3000,
          dir: 'alternate',
          loop: true
        });
        galaxiasContainer.appendChild(g);
      }
    }

    crearEstrellas(300);
    crearGalaxias(12);

    // LÓGICA DE INTERACCIÓN
    btnAccion.addEventListener('click', () => {
      contenedorBtn.setAttribute('visible', 'false');
      telonNegro.emit('cineStart');
      
      setTimeout(() => {
        estrellasContainer.setAttribute('visible', 'true');
        galaxiasContainer.setAttribute('visible', 'true');
        pantalla.setAttribute('visible', 'true');
        pantalla.emit('videoEntra');
        video.play();
      }, 2000);
    });

    video.addEventListener('ended', () => {
      telonNegro.emit('cineEnd');
      estrellasContainer.setAttribute('visible', 'false');
      galaxiasContainer.setAttribute('visible', 'false');
      pantalla.emit('videoSale');
      setTimeout(() => {
        pantalla.setAttribute('visible', 'false');
        contenedorBtn.setAttribute('visible', 'true');
      }, 4000);
    });
  </script>
</body>
</html>








